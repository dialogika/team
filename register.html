<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Registration | Kursus Public Speaking Dialogika</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- CSS Files (Tidak ada perubahan di bagian atas head) -->
  <link href="assets/img/favicon.webp" rel="icon">
  <link href="assets/img/apple-touch-icon.webp" rel="apple-touch-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link href="assets/vendor/bootstrap/css/bootstrap.css" rel="stylesheet" />
  <link href="assets/css/style.css" rel="stylesheet" />
  
  <style>
      /* CSS ANDA YANG SUDAH BAGUS TETAP DISINI */
      body { background: #f1f7fd; font-family: 'Poppins', sans-serif; min-height: 100vh; padding: 20px 0; }
      .main-layout { display: flex; flex-direction: column; align-items: center; gap: 30px; }
      
      /* ... (Seluruh CSS Card dan Form Anda tetap sama, saya persingkat untuk fokus ke logika) ... */
      
      .card-wrapper { perspective: 1000px; width: 100%; max-width: 420px; height: 260px; cursor: pointer; margin: 0 auto; }
      .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.8s; transform-style: preserve-3d; }
      .card-wrapper.flipped .card-inner { transform: rotateY(180deg); }
      .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 15px; box-shadow: 0 15px 35px rgba(0,0,0,0.3); overflow: hidden; color: white; }
      
      /* FRONT SIDE */
      .card-front { background-image: url('assets/img/card-front.jpg'); background-color: #07276B; background-size: cover; background-position: center; padding: 25px; display: flex; flex-direction: column; }
      
      /* BACK SIDE */
      .card-back { transform: rotateY(180deg); background: linear-gradient(135deg, #07276B 0%, #1E81D0 100%); }
      .card-back::before { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-image: url("https://www.transparenttextures.com/patterns/cubes.png"); opacity: 0.15; mix-blend-mode: overlay; }

      /* Elements */
      .card-top { display: flex; justify-content: space-between; align-items: flex-start; }
      .card-chip { width: 50px; height: 35px; background: linear-gradient(135deg, #d4af37, #f2e298); border-radius: 5px; position: relative; border: 1px solid rgba(0,0,0,0.1); }
      .photo-area { position: absolute; top: 25px; right: 25px; text-align: center; }
      .photo-preview-card { width: 70px; height: 70px; border-radius: 8px; background-color: rgba(255,255,255,0.1); background-size: cover; background-position: center; border: 1px solid rgba(255,255,255,0.5); margin-bottom: 5px; }
      .birth-label { font-size: 8px; text-transform: uppercase; display: block; }
      .birth-date-display { font-family: 'Share Tech Mono', monospace; font-size: 14px; }
      .card-number-container { margin-top: 35px; }
      .card-number { font-family: 'Share Tech Mono', monospace; font-size: 20px; letter-spacing: 2px; width: 100%; }
      .card-password-display { font-family: monospace; font-size: 14px; letter-spacing: 3px; color: rgba(255,255,255,0.9); }
      .card-bottom { margin-top: auto; display: flex; justify-content: space-between; align-items: flex-end; }
      .detail-value-name { font-family: 'Share Tech Mono', monospace; font-size: 16px; font-weight: bold; text-transform: uppercase; }
      .detail-value-pos { font-family: 'Poppins', sans-serif; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: #FFD700; }
      
      /* Back Elements */
      .magnetic-strip { position: absolute; top: 25px; left: 0; width: 100%; height: 45px; background: #1a1a1a; }
      .signature-strip { position: absolute; top: 100px; left: 15px; right: 15px; height: 35px; background: white; display: flex; align-items: center; padding-left: 10px; background-image: url("https://www.transparenttextures.com/patterns/diagonal-stripes.png"); }
      .email-display-back { color: #333; font-family: 'Share Tech Mono', monospace; font-size: 12px; }
      .cvv-label { position: absolute; top: 85px; left: 15px; font-size: 10px; text-transform: uppercase; }
      .visa-logo-back { position: absolute; bottom: 20px; right: 25px; }
      .back-details { position: absolute; bottom: 20px; left: 20px; text-align: left; font-size: 10px; opacity: 0.8; line-height: 1.6; }

      /* Form & Upload */
      .form-box { background: white; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); padding: 30px; width: 100%; max-width: 600px; }
      .upload-area { display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; height: 180px; background-color: #f0f7ff; border: 2px dashed #1E81D0; border-radius: 12px; cursor: pointer; text-align: center; padding: 20px; }
      .upload-area:hover { background-color: #e1efff; border-color: #07276B; }
      .upload-icon { font-size: 40px; color: #1E81D0; margin-bottom: 10px; }
      .password-wrapper { position: relative; }
      .password-toggle { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #6c757d; }
  </style>
</head>

<body>

  <!-- ======= Header ======= -->
  <main-header></main-header>

  <!-- ======= Breadcrumbs ======= -->
  <section class="breadcrumbs" style="margin-top: 110px;">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center" >
        <h2>Staff Studio</h2>
        <ol>
          <li><a href="../index.html">Home</a></li>
          <li><a href="index.html">Login</a></li>
          <li><a href="register.html">Registration</a></li>
        </ol>
      </div>
    </div>
  </section>

  <main id="main">
  
  <div class="container main-layout" style="margin-top: 30px; margin-bottom: 30px;">
      
      <!-- 1. BAGIAN KARTU -->
      <div style="width: 100%; margin-bottom:-200px">
          <div class="card-wrapper" id="cardWrapper" onclick="toggleFlip()">
              <div class="card-inner">
                  
                  <!-- DEPAN -->
                  <div class="card-face card-front">
                      <div class="card-top">
                          <div class="card-chip"></div>
                          <div class="photo-area">
                              <div class="photo-preview-card" id="cardPhotoPreview"></div>
                              <span class="birth-label">Birth Date</span>
                              <div class="birth-date-display" id="cardBirthFront">MM/YY</div>
                          </div>
                      </div>

                      <div class="card-number-container">
                          <div class="card-number" id="cardIDDisplay">#### #### #### ####</div>
                          <div class="card-password-display" id="cardPassDisplay">****</div>
                      </div>

                      <div class="card-bottom">
                          <div>
                              <div class="detail-label">Card Holder</div>
                              <div class="detail-value-name" id="cardName">FULL NAME</div>
                              <div class="detail-value-pos" id="cardPosDisplay">POSITION</div>
                          </div>
                          <img style="max-height:25px;" src="https://www.dialogika.co/assets/img/white-logo.webp" alt="Dialogika" class="logo-img" onerror="this.src='https://via.placeholder.com/100x40?text=DIALOGIKA'">
                      </div>
                  </div>

                  <!-- BELAKANG -->
                  <div class="card-face card-back">
                      <div class="magnetic-strip"></div>
                      <span class="cvv-label">EMAIL</span>
                      <div class="signature-strip">
                          <div class="email-display-back" id="cardEmailBack">email@example.com</div>
                      </div>
                      <div class="back-details">
                          <div id="cardPhone">Tel: -</div>
                          <div id="cardIG">IG: -</div>
                          <div id="cardLinked">In: -</div>
                      </div>
                      <img src="https://www.dialogika.co/assets/img/white-logo.webp" style="max-height:25px;" alt="Dialogika" class="logo-img visa-logo-back" onerror="this.src='https://via.placeholder.com/100x40?text=DIALOGIKA'">
                  </div>
              </div>
          </div>
          <p class="text-center text-muted small mt-2">Klik kartu untuk melihat sisi belakang</p>
      </div>

      <!-- 2. BAGIAN FORM -->
      <div class="form-box" style="padding-top:150px;">
          <h4 class="mb-4 text-center fw-bold" style="color: #07276B;">Registrasi Team</h4>
          <form id="regForm">
              
              <div class="row">
                  <div class="col-md-6 mb-3">
                      <label class="form-label">Full Name</label>
                      <input type="text" class="form-control" id="inputName" name="name" placeholder="Nama Lengkap" required oninput="updateCard()">
                  </div>
                  <div class="col-md-6 mb-3">
                      <label class="form-label">Position</label>
                      <!-- Opsi di sini akan diisi otomatis oleh Javascript -->
                      <select class="form-select" id="inputPos" required onchange="updateCard()">
                          <option value="" disabled selected>Loading positions...</option>
                      </select>
                  </div>
              </div>

              <div class="mb-3">
                  <label class="form-label">Email</label>
                  <input type="email" class="form-control" id="inputEmail" name="email" placeholder="email@address.com" required oninput="updateCard('back')">
              </div>

              <div class="mb-3">
                  <label class="form-label">Password (Hidden on Card)</label>
                  <div class="password-wrapper">
                      <input type="password" class="form-control" id="inputPass" name="password" required oninput="updateCard()">
                      <i class="fas fa-eye password-toggle" onclick="togglePasswordVisibility()"></i>
                  </div>
              </div>

              <div class="mb-3">
                  <label class="form-label">Upload Photo</label>
                  <label for="inputPhoto" class="upload-area">
                      <i class="fas fa-cloud-upload-alt upload-icon"></i>
                      <span class="upload-text" id="uploadText">Klik untuk upload foto</span>
                      <span class="upload-hint">Format PNG, JPG (Max. 5MB)</span>
                      <input type="file" id="inputPhoto" accept="image/*" hidden required onchange="previewImage()">
                  </label>
              </div>

              <div class="row">
                  <div class="col-md-6 mb-3">
                      <label class="form-label">Birth Date</label>
                      <input type="date" class="form-control" id="inputBirth" name="birth" required oninput="updateCard()">
                  </div>
                  <div class="col-md-6 mb-3">
                      <label class="form-label">Phone</label>
                      <input type="tel" class="form-control" id="inputPhone" placeholder="08..." required oninput="updateCard('back')">
                  </div>
              </div>

              <div class="row">
                  <div class="col-md-6 mb-3">
                      <label class="form-label">Instagram (@username)</label>
                      <input type="text" class="form-control" id="inputIG" placeholder="instagram.com/...." oninput="updateCard('back')">
                  </div>
                  <div class="col-md-6 mb-3">
                      <label class="form-label">LinkedIn (Link)</label>
                      <input type="text" class="form-control" id="inputLinked" placeholder="linkedin.com/in/...." oninput="updateCard('back')">
                  </div>
              </div>

              <button type="submit" class="btn blue-dialogika-btn w-100 mt-3" id="btnSubmit" style="border-radius:10px;">Submit Registration</button>
          </form>
      </div>
  </div>

  <script>
      // === UPDATE URL INI SANGAT PENTING ===
      const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz0slQZMIQsik2_WG9-Ff-IP1oIyIW-JoJxZaO0AuRdczjIn4cVMnKV6FxB3wgq93Hh/exec';

      const cardWrapper = document.getElementById('cardWrapper');
      const randomFirstFour = Math.floor(1000 + Math.random() * 9000);
      const hiddenMiddle = "#### ####";

      // --- 1. FETCH POSITIONS DARI SPREADSHEET ---
      document.addEventListener('DOMContentLoaded', function() {
          const selectPos = document.getElementById('inputPos');
          
          fetch(SCRIPT_URL + '?action=getPositions')
              .then(response => response.json())
              .then(data => {
                  selectPos.innerHTML = '<option value="" disabled selected>Pilih Posisi</option>'; // Reset opsi
                  if(Array.isArray(data) && data.length > 0) {
                      data.forEach(pos => {
                          const option = document.createElement('option');
                          option.value = pos;
                          option.text = pos;
                          selectPos.appendChild(option);
                      });
                  } else {
                      const option = document.createElement('option');
                      option.text = "Gagal memuat posisi";
                      selectPos.appendChild(option);
                  }
              })
              .catch(error => {
                  console.error('Error fetching positions:', error);
                  selectPos.innerHTML = '<option value="" disabled selected>Gagal memuat data</option>';
              });
      });

      function toggleFlip() { cardWrapper.classList.toggle('flipped'); }

      function togglePasswordVisibility() {
          const passInput = document.getElementById('inputPass');
          const icon = document.querySelector('.password-toggle');
          if (passInput.type === 'password') {
              passInput.type = 'text'; icon.classList.remove('fa-eye'); icon.classList.add('fa-eye-slash');
          } else {
              passInput.type = 'password'; icon.classList.remove('fa-eye-slash'); icon.classList.add('fa-eye');
          }
      }

      function updateCard(side) {
          const name = document.getElementById('inputName').value;
          const email = document.getElementById('inputEmail').value;
          const pass = document.getElementById('inputPass').value;
          const birthDate = document.getElementById('inputBirth').value;
          const phone = document.getElementById('inputPhone').value;
          const pos = document.getElementById('inputPos').value;
          const ig = document.getElementById('inputIG').value;
          const linked = document.getElementById('inputLinked').value;

          // FRONT
          document.getElementById('cardName').innerText = name || 'FULL NAME';
          document.getElementById('cardPosDisplay').innerText = pos || 'POSITION';

          let maskedPass = "";
          for(let i=0; i<pass.length; i++) { maskedPass += "*"; }
          document.getElementById('cardPassDisplay').innerText = maskedPass || "****";

          let expiresText = "MM/YY";
          let idSuffix = "####";

          if (birthDate) {
              const dateObj = new Date(birthDate);
              const mm = String(dateObj.getMonth() + 1).padStart(2, '0');
              const dd = String(dateObj.getDate()).padStart(2, '0');
              const yy = String(dateObj.getFullYear()).slice(-2);
              expiresText = `${mm}/${yy}`;
              idSuffix = `${mm}${dd}`;
          }
          document.getElementById('cardBirthFront').innerText = expiresText;
          document.getElementById('cardIDDisplay').innerText = `${randomFirstFour} ${hiddenMiddle} ${idSuffix}`;

          // BACK
          document.getElementById('cardEmailBack').innerText = email || 'email@example.com';
          document.getElementById('cardPhone').innerText = phone ? `Tel: ${phone}` : 'Tel: -';
          document.getElementById('cardIG').innerText = ig ? `IG: ${ig}` : 'IG: -';
          document.getElementById('cardLinked').innerText = linked ? `In: ${linked}` : 'In: -';

          if(side === 'back' && !cardWrapper.classList.contains('flipped')) {
              cardWrapper.classList.add('flipped');
          }
      }

      function previewImage() {
          const fileInput = document.getElementById('inputPhoto');
          const file = fileInput.files[0];
          const uploadText = document.getElementById('uploadText');

          if (file) {
              uploadText.innerText = "Terpilih: " + file.name;
              uploadText.style.color = "#07276B";
              const reader = new FileReader();
              reader.onload = function(e) {
                  document.getElementById('cardPhotoPreview').style.backgroundImage = `url(${e.target.result})`;
              }
              reader.readAsDataURL(file);
          } else {
              uploadText.innerText = "Klik untuk upload foto";
          }
      }

      document.getElementById('regForm').addEventListener('submit', function(e) {
          e.preventDefault();
          const btn = document.getElementById('btnSubmit');
          btn.innerText = "Mengirim..."; btn.disabled = true;

          const file = document.getElementById('inputPhoto').files[0];
          const reader = new FileReader();

          reader.onload = function(e) {
              const middleRandom = Math.floor(10000000 + Math.random() * 90000000);
              const birthDate = document.getElementById('inputBirth').value;
              let idSuffix = "0000";
              if(birthDate) {
                  const dateObj = new Date(birthDate);
                  const mm = String(dateObj.getMonth() + 1).padStart(2, '0');
                  const dd = String(dateObj.getDate()).padStart(2, '0');
                  idSuffix = `${mm}${dd}`;
              }
              const fullId = `${randomFirstFour}${middleRandom}${idSuffix}`;

              const payload = {
                  generatedId: fullId,
                  name: document.getElementById('inputName').value,
                  email: document.getElementById('inputEmail').value,
                  password: document.getElementById('inputPass').value,
                  phone: document.getElementById('inputPhone').value,
                  birth: birthDate,
                  position: document.getElementById('inputPos').value,
                  instagram: document.getElementById('inputIG').value,
                  linkedin: document.getElementById('inputLinked').value,
                  photoData: e.target.result,
                  photoName: file.name,
                  photoType: file.type
              };

              fetch(SCRIPT_URL, {
                  method: 'POST',
                  body: JSON.stringify(payload)
              })
              .then(res => res.json())
              .then(data => {
                  if(data.result === 'success') {
                      alert('Registrasi Berhasil! ID Team: ' + fullId);
                      window.location.reload();
                  } else {
                      alert('Gagal: ' + data.error);
                  }
              })
              .catch(err => {
                  alert('Error jaringan atau Script URL belum diupdate.');
                  console.error(err);
              })
              .finally(() => {
                  btn.innerText = "Submit Registration";
                  btn.disabled = false;
              });
          };

          if(file) reader.readAsDataURL(file);
      });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Main JS (Header/Footer) -->
  <script src="assets/js/headerfooter.js"></script>

  </main>
  <main-footer></main-footer>
</body>
</html>
