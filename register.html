<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - Team Dialogika</title>
    
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Google Fonts: Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Font Awesome (Required for Eye Icon) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            /* --- Dialogika Color Palette --- */
            --dlg-blue: #0B2B6A;
            --dlg-blue-start: #0B2B6A;
            --dlg-blue-end: #1247af;
            --dlg-yellow: #f7b12c;
            --dlg-yellow-end: #F9C72E;
            --bg-body: #F8FAFC;
            --topbar-height: 70px;
        }

        /* --- PERBAIKAN STRUKTUR LAYOUT UTAMA --- */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f1f7fd; /* Warna background dari style ke-2 */
            color: #1f2937;
            /* Flex Layout untuk Sticky Footer */
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
            padding: 0; /* MENGHAPUS padding: 20px 0 yang bikin gap */
        }

        /* --- TOP BAR (Fixed) --- */
        .top-bar {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: var(--topbar-height);
            background: white;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center; /* Center Logo */
            padding: 0 30px;
            z-index: 1001;
            box-shadow: 0 2px 10px rgba(0,0,0,0.02);
        }

        .logo-center {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        /* --- MAIN LAYOUT WRAPPER --- */
        .main-layout {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            /* Flex 1 agar mengisi ruang kosong dan mendorong footer ke bawah */
            flex: 1; 
            width: 100%;
            margin-top: var(--topbar-height);
            padding-top: 30px;
            padding-bottom: 50px; /* Jarak antara konten dan footer */
        }

        /* --- CARD STYLES --- */
        .card-wrapper { perspective: 1000px; width: 100%; max-width: 420px; height: 260px; cursor: pointer; margin: 0 auto; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.8s; transform-style: preserve-3d; }
        .card-wrapper.flipped .card-inner { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 15px; box-shadow: 0 15px 35px rgba(0,0,0,0.3); overflow: hidden; color: white; }
        
        /* Front */
        .card-front { background-image: url('assets/img/card-front.jpg'); background-color: #07276B; background-size: cover; background-position: center; padding: 25px; display: flex; flex-direction: column; }
        /* Back */
        .card-back { transform: rotateY(180deg); background: linear-gradient(135deg, #07276B 0%, #1E81D0 100%); }
        .card-back::before { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-image: url("https://www.transparenttextures.com/patterns/cubes.png"); opacity: 0.15; mix-blend-mode: overlay; }

        /* Elements */
        .card-top { display: flex; justify-content: space-between; align-items: flex-start; }
        .card-chip { width: 50px; height: 35px; background: linear-gradient(135deg, #d4af37, #f2e298); border-radius: 5px; position: relative; border: 1px solid rgba(0,0,0,0.1); }
        .photo-area { position: absolute; top: 25px; right: 25px; text-align: center; }
        .photo-preview-card { width: 70px; height: 70px; border-radius: 8px; background-color: rgba(255,255,255,0.1); background-size: cover; background-position: center; border: 1px solid rgba(255,255,255,0.5); margin-bottom: 5px; }
        .birth-label { font-size: 8px; text-transform: uppercase; display: block; }
        .birth-date-display { font-family: 'Share Tech Mono', monospace; font-size: 14px; }
        .card-number-container { margin-top: 35px; }
        .card-number { font-family: 'Share Tech Mono', monospace; font-size: 20px; letter-spacing: 2px; width: 100%; }
        .card-password-display { font-family: monospace; font-size: 14px; letter-spacing: 3px; color: rgba(255,255,255,0.9); }
        .card-bottom { margin-top: auto; display: flex; justify-content: space-between; align-items: flex-end; }
        .detail-value-name { font-family: 'Share Tech Mono', monospace; font-size: 16px; font-weight: bold; text-transform: uppercase; }
        .detail-value-pos { font-family: 'Poppins', sans-serif; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: #FFD700; }
        
        /* Back Elements */
        .magnetic-strip { position: absolute; top: 25px; left: 0; width: 100%; height: 45px; background: #1a1a1a; }
        .signature-strip { position: absolute; top: 100px; left: 15px; right: 15px; height: 35px; background: white; display: flex; align-items: center; padding-left: 10px; background-image: url("https://www.transparenttextures.com/patterns/diagonal-stripes.png"); }
        .email-display-back { color: #333; font-family: 'Share Tech Mono', monospace; font-size: 12px; }
        .cvv-label { position: absolute; top: 85px; left: 15px; font-size: 10px; text-transform: uppercase; }
        .visa-logo-back { position: absolute; bottom: 20px; right: 25px; }
        .back-details { position: absolute; bottom: 20px; left: 20px; text-align: left; font-size: 10px; opacity: 0.8; line-height: 1.6; }

        /* Form Elements */
        .form-box { background: white; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); padding: 30px; width: 100%; max-width: 600px; }
        .upload-area { display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; height: 180px; background-color: #f0f7ff; border: 2px dashed #1E81D0; border-radius: 12px; cursor: pointer; text-align: center; padding: 20px; }
        .upload-area:hover { background-color: #e1efff; border-color: #07276B; }
        .upload-icon { font-size: 40px; color: #1E81D0; margin-bottom: 10px; }
        .password-wrapper { position: relative; }
        .password-toggle { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #6c757d; }

        /* BUTTONS */
        .blue-dialogika-btn {
            background: linear-gradient(to bottom, #0f61a8 5%, #0b2b6a 100%);
            box-shadow: 0px 5px 16px -6px rgba(114, 4, 207, 1);
            color: #fff; border: none; transition: 0.3s;
        }
        .blue-dialogika-btn:hover {
            background: linear-gradient(to bottom, #0b2b6a 5%, #0f61a8 100%);
            color: #fff;
        }

        /* --- FOOTER FIXED STYLE --- */
        footer {
            width: 100%;
            margin-top: auto; /* Kunci agar footer menempel ke bawah jika konten pendek */
            background: #0B2B6A;
            z-index: 10;
        }

        #footer {
            font-size: 14px;
            background: #0B2B6A;
            color:#fff;
            padding: 0;
        }
        
        #footer .container {
            padding-top: 20px;
            padding-bottom: 20px;
        }

        #footer .credits {    
            padding-top: 5px;
            font-size: 13px;
            color: #444444;
        }

        #footer .social-links a {
        font-size: 18px;
        display: inline-block;
        background: #fff;
        color: #0b2b6a;
        line-height: 1;
        padding: 8px 0;
        margin-right: 4px;
        border-radius: 50%;
        text-align: center;
        width: 36px;
        height: 36px;
        transition: 0.3s;
        box-shadow: 0px -10px 15px -6px rgba(114, 4, 207, 0.75) inset;
        -webkit-box-shadow: 0px -10px 15px -6px rgba(114, 4, 207, 0.75) inset;
        -moz-box-shadow: 0px -10px 15px -6px rgba(114, 4, 207, 0.75) inset;
        }

        #footer .social-links a:hover {
        background: #7204cf;
        color: #fff;
        text-decoration: none;
        box-shadow: 0px 0px 4px 2px rgba(114, 4, 207, 0.75);
        -webkit-box-shadow: 0px 0px 4px 2px rgba(114, 4, 207, 0.75);
        -moz-box-shadow: 0px 0px 4px 2px rgba(114, 4, 207, 0.75);
        }

        /* Responsif Mobile */
        @media (max-width: 768px) {
            #footer .container {
                flex-direction: column;
                text-align: center !important;
                gap: 15px;
            }
            .me-md-auto {
                text-align: center !important;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- 1. TOP BAR FIXED -->
    <nav class="top-bar">
        <!-- CENTER: LOGO DIALOGIKA -->
        <div class="logo-center">
            <img src="https://www.dialogika.co/assets/img/logo.webp" alt="Dialogika Logo" height="35">
        </div>        
    </nav>

    <!-- WRAPPER CONTENT (Flex Item) -->
    <div class="container main-layout">
      
      <!-- 1. BAGIAN KARTU -->
      <div style="width: 100%; margin-bottom:-200px">
          <div class="card-wrapper" id="cardWrapper" onclick="toggleFlip()">
              <div class="card-inner">
                  <!-- DEPAN -->
                  <div class="card-face card-front">
                      <div class="card-top">
                          <div class="card-chip"></div>
                          <div class="photo-area">
                              <div class="photo-preview-card" id="cardPhotoPreview"></div>
                              <span class="birth-label">Birth Date</span>
                              <div class="birth-date-display" id="cardBirthFront">MM/YY</div>
                          </div>
                      </div>

                      <div class="card-number-container">
                          <div class="card-number" id="cardIDDisplay">#### #### #### ####</div>
                          <div class="card-password-display" id="cardPassDisplay">****</div>
                      </div>

                      <div class="card-bottom">
                          <div>
                              <div class="detail-label">Card Holder</div>
                              <div class="detail-value-name" id="cardName">FULL NAME</div>
                              <div class="detail-value-pos" id="cardPosDisplay">POSITION</div>
                          </div>
                          <img style="max-height:25px;" src="https://www.dialogika.co/assets/img/white-logo.webp" alt="Dialogika" class="logo-img" onerror="this.src='https://via.placeholder.com/100x40?text=DIALOGIKA'">
                      </div>
                  </div>

                  <!-- BELAKANG -->
                  <div class="card-face card-back">
                      <div class="magnetic-strip"></div>
                      <span class="cvv-label">EMAIL</span>
                      <div class="signature-strip">
                          <div class="email-display-back" id="cardEmailBack">email@example.com</div>
                      </div>
                      <div class="back-details">
                          <div id="cardPhone">Tel: -</div>
                          <div id="cardIG">IG: -</div>
                          <div id="cardLinked">In: -</div>
                      </div>
                      <img src="https://www.dialogika.co/assets/img/white-logo.webp" style="max-height:25px;" alt="Dialogika" class="logo-img visa-logo-back" onerror="this.src='https://via.placeholder.com/100x40?text=DIALOGIKA'">
                  </div>
              </div>
          </div>
          <p class="text-center text-muted small mt-2">Klik kartu untuk melihat sisi belakang</p>
      </div>

      <!-- 2. BAGIAN FORM -->
      <div class="form-box" style="padding-top:150px;">
          <h4 class="mb-4 text-center fw-bold" style="color: #07276B;">Registrasi Team</h4>
          <form id="regForm">
              
              <div class="row">
                  <div class="col-md-6 mb-3">
                      <label class="form-label">Full Name</label>
                      <input type="text" class="form-control" id="inputName" name="name" placeholder="Nama Lengkap" required oninput="updateCard()">
                  </div>
                  <div class="col-md-6 mb-3">
                      <label class="form-label">Position</label>
                      <select class="form-select" id="inputPos" required onchange="updateCard()">
                          <option value="" disabled selected>Loading...</option>
                      </select>
                  </div>
              </div>

              <div class="mb-3">
                  <label class="form-label">Email</label>
                  <input type="email" class="form-control" id="inputEmail" name="email" placeholder="email@address.com" required oninput="updateCard('back')">
              </div>

              <div class="mb-3">
                  <label class="form-label">Password</label>
                  <div class="password-wrapper">
                      <input type="password" class="form-control" id="inputPass" name="password" required oninput="updateCard()">
                      <i class="fas fa-eye password-toggle" onclick="togglePasswordVisibility()"></i>
                  </div>
              </div>

              <div class="mb-3">
                  <label class="form-label">Upload Photo</label>
                  <label for="inputPhoto" class="upload-area">
                      <i class="fas fa-cloud-upload-alt upload-icon"></i>
                      <span class="upload-text" id="uploadText">Klik untuk upload foto</span>
                      <span class="upload-hint">Format PNG, JPG (Max. 5MB)</span>
                      <input type="file" id="inputPhoto" accept="image/*" hidden required onchange="previewImage()">
                  </label>
              </div>

              <div class="row">
                  <div class="col-md-6 mb-3">
                      <label class="form-label">Birth Date</label>
                      <input type="date" class="form-control" id="inputBirth" name="birth" required oninput="updateCard()">
                  </div>
                  <div class="col-md-6 mb-3">
                      <label class="form-label">Phone</label>
                      <input type="tel" class="form-control" id="inputPhone" placeholder="08..." required oninput="updateCard('back')">
                  </div>
              </div>

              <div class="row">
                  <div class="col-md-6 mb-3">
                      <label class="form-label">Instagram (@username)</label>
                      <input type="text" class="form-control" id="inputIG" placeholder="instagram.com/...." oninput="updateCard('back')">
                  </div>
                  <div class="col-md-6 mb-3">
                      <label class="form-label">LinkedIn (Link)</label>
                      <input type="text" class="form-control" id="inputLinked" placeholder="linkedin.com/in/...." oninput="updateCard('back')">
                  </div>
              </div>

              <button type="submit" class="btn blue-dialogika-btn w-100 mt-3" id="btnSubmit" style="border-radius:10px;">Submit Registration</button>
          </form>
      </div>
    </div>

    <!-- 3. FOOTER -->
    <footer>
        <div id="footer">
            <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center">

                <div class="me-md-auto text-center text-md-start">
                    <div class="copyright">
                    &copy; Copyright <strong><span>Dialogika</span></strong> | PT. Dialogika Persona Indonesia
                    </div>
                </div>

                <div class="social-links text-center text-md-right">
                    <a href="https://link.dialogika.co/twitter" class="twitter"><i class="bi bi-twitter"></i></a>
                    <a href="https://link.dialogika.co/facebook" class="facebook"><i class="bi bi-facebook"></i></a>
                    <a href="https://link.dialogika.co/instagram" class="instagram"><i class="bi bi-instagram"></i></a>
                    <a href="https://wa.link/emi1qx" class="instagram"><i class="bi bi-whatsapp"></i></a>
                    <a href="https://link.dialogika.co/linkedin" class="instagram"><i class="bi bi-linkedin"></i></a>
                </div>

            </div>
        </div>
    </footer>

  <!-- Firebase SDK Modular -->
  <script type="module">
      // 1. Import Firebase Functions 
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"; 
      import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"; 
      import { getFirestore, doc, setDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"; 
      import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js"; 

      // 2. Konfigurasi Firebase Anda
      const firebaseConfig = { 
            apiKey: "AIzaSyDyzzEYbJkkl-N8snrQf14qvj8De4YliV0", // Kunci baru dari gambar Anda
            authDomain: "pre-dialogika.firebaseapp.com", 
            projectId: "pre-dialogika", 
            storageBucket: "pre-dialogika.firebasestorage.app", 
            messagingSenderId: "343771410480", 
            appId: "1:343771410480:web:32881c9868522090237df5", 
            measurementId: "G-SXN811P3N0" 
        };

      // Initialize Firebase 
      const app = initializeApp(firebaseConfig); 
      const auth = getAuth(app); 
      const db = getFirestore(app); 
      const storage = getStorage(app); 

      // --- UI LOGIC (Tetap sama seperti aslinya) --- 
      const cardWrapper = document.getElementById('cardWrapper'); 
      const randomFirstFour = Math.floor(1000 + Math.random() * 9000); 
      const hiddenMiddle = "#### ####"; 

      window.toggleFlip = () => cardWrapper.classList.toggle('flipped'); 

      window.togglePasswordVisibility = () => { 
          const passInput = document.getElementById('inputPass'); 
          const icon = document.querySelector('.password-toggle'); 
          if (passInput.type === 'password') { 
              passInput.type = 'text'; 
              icon.classList.replace('fa-eye', 'fa-eye-slash'); 
          } else { 
              passInput.type = 'password'; 
              icon.classList.replace('fa-eye-slash', 'fa-eye'); 
          } 
      }; 

      window.updateCard = (side) => { 
          const name = document.getElementById('inputName').value; 
          const email = document.getElementById('inputEmail').value; 
          const pass = document.getElementById('inputPass').value; 
          const birthDate = document.getElementById('inputBirth').value; 
          const pos = document.getElementById('inputPos').value; 

          document.getElementById('cardName').innerText = name || 'FULL NAME'; 
          document.getElementById('cardPosDisplay').innerText = pos || 'POSITION'; 
          document.getElementById('cardPassDisplay').innerText = "*".repeat(pass.length) || "****"; 

          if (birthDate) { 
              const d = new Date(birthDate); 
              document.getElementById('cardBirthFront').innerText = `${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getFullYear()).slice(-2)}`; 
              document.getElementById('cardIDDisplay').innerText = `${randomFirstFour} ${hiddenMiddle} ${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}`; 
          } 
          document.getElementById('cardEmailBack').innerText = email || 'email@example.com'; 
          if(side === 'back') cardWrapper.classList.add('flipped'); 
      }; 

      window.previewImage = () => { 
          const file = document.getElementById('inputPhoto').files[0]; 
          if (file) { 
              document.getElementById('uploadText').innerText = file.name; 
              const reader = new FileReader(); 
              reader.onload = (e) => document.getElementById('cardPhotoPreview').style.backgroundImage = `url(${e.target.result})`; 
              reader.readAsDataURL(file); 
          } 
      };

      // --- 3. FETCH POSISI DARI MASTER FIRESTORE --- 
      async function loadPositions() { 
          const selectPos = document.getElementById('inputPos'); 
          try { 
              const querySnapshot = await getDocs(collection(db, "positions")); 
              selectPos.innerHTML = '<option value="" disabled selected>Pilih Posisi</option>'; 
              querySnapshot.forEach((d) => { 
                  const opt = document.createElement('option'); 
                  opt.value = d.data().name; 
                  opt.text = d.data().name; 
                  selectPos.appendChild(opt); 
              }); 
          } catch (e) { 
              console.error("Gagal load posisi:", e); 
              selectPos.innerHTML = '<option>Gagal memuat data</option>'; 
          } 
      } 
      loadPositions(); 

      // --- 4. PROSES REGISTRASI KE FIREBASE --- 
      document.getElementById('regForm').addEventListener('submit', async (e) => { 
          e.preventDefault(); 
          const btn = document.getElementById('btnSubmit'); 
          btn.innerText = "Processing..."; 
          btn.disabled = true; 

          const email = document.getElementById('inputEmail').value; 
          const password = document.getElementById('inputPass').value; 
          const file = document.getElementById('inputPhoto').files[0]; 

          try { 
              const userCredential = await createUserWithEmailAndPassword(auth, email, password); 
              const user = userCredential.user; 

              let photoURL = ""; 
              if (file) { 
                  const storageRef = ref(storage, `users/${user.uid}/profile_photo`); 
                  await uploadBytes(storageRef, file); 
                  photoURL = await getDownloadURL(storageRef); 
              } 

              await setDoc(doc(db, "users", user.uid), { 
                  name: document.getElementById('inputName').value, 
                  email: email, 
                  birth: document.getElementById('inputBirth').value, 
                  phone: document.getElementById('inputPhone').value, 
                  photo: photoURL, 
                  employment: { 
                      position: document.getElementById('inputPos').value, 
                      department: "", 
                      joined_at: new Date() 
                  }, 
                  socials: { 
                      instagram: document.getElementById('inputIG').value, 
                      linkedin: document.getElementById('inputLinked').value 
                  }, 
                  access: { 
                      role_id: "staff", 
                      level_order: 3 
                  } 
              }); 

              alert('Registrasi Berhasil! Data tersimpan di Firebase.'); 
              window.location.reload(); 

          } catch (error) { 
              console.error(error); 
              alert('Error: ' + error.message); 
          } finally { 
              btn.innerText = "Submit Registration"; 
              btn.disabled = false; 
          } 
      }); 
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
